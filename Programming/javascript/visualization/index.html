<html>
    <head>
        <!-- Link to latest version of D3.js and other dependencies needed for the plotting library--->
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

        <!--Script for requesting the data -->
        <script type="text/javascript">
            function processInput(){
                var form = document.getElementById("form");
                var data = {};

                data[text] = form.content;
                //Prepare the connection
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "http://localhost:5000/predict/single" );
                xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
                xhr.responseType = 'json';
                xhr.onload = function() { //Handles the response by the server
                    var status = xhr.status;
                    if (status == 200) {
                        alert('Something went wrong: ' + xhr.response);
                    } else {
                        //TODO: Initialize the visualization.
                    }
                };
                xhr.send(JSON.stringify(data));

            }
        </script>

        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="title">
            <h1>Visualization</h1>
        </div>
        <div>
            <form id="form">
                <textarea placeholder="input a post..." rows="6" name="content"></textarea>
                <button action="POST" value="">Submit</button>
            </form>
        </div>

            <script>
                // set the dimensions of the canvas
                var margin = {top: 20, right: 20, bottom: 70, left: 40},
                    width = 600 - margin.left - margin.right,
                    height = 300 - margin.top - margin.bottom;


                // set the ranges
                var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

                var y = d3.scale.linear().range([height, 0]);

                // define the axis
                var xAxis = d3.svg.axis()
                    .scale(x)
                    .orient("bottom")


                var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient("left")
                    .ticks(10);


                // add the SVG element
                var svg = d3.select("body").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");


                // load the data
                function update(data){
                    data.forEach(function(d) {
                        d.Letter = d.Letter;
                        d.Freq = +d.Freq; //TODO: Find out what this line does. Does it make sure the Freq variable is not empty?
                    });

                    // scale the range of the data
                    x.domain(data.map(function(d) { return d.Letter; }));
                    y.domain([0, d3.max(data, function(d) { return d.Freq; })]);

                    // add axis
                    svg.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis)
                        .selectAll("text")
                        .style("text-anchor", "end")
                        .attr("dx", "-.8em")
                        .attr("dy", "-.55em")
                        .attr("transform", "rotate(-90)" );

                    svg.append("g")
                        .attr("class", "y axis")
                        .call(yAxis)
                        .append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 5)
                        .attr("dy", ".71em")
                        .style("text-anchor", "end")
                        .text("Frequency");

                    // Add bar chart
                    svg.selectAll("bar")
                        .data(data)
                        .enter().append("rect")
                        .attr("class", "bar")
                        .attr("x", function(d) { return x(d.Letter); })
                        .attr("width", x.rangeBand())
                        .attr("y", function(d) { return y(d.Freq); })
                        .attr("height", function(d) { return height - y(d.Freq); });

                }


                /*    OLD CODE, To be adapted to use data retrieved from server.


                d3.json("data.json", function(error, data) {

                    data.forEach(function(d) {
                        d.Letter = d.Letter;
                        d.Freq = +d.Freq;
                    });

                    // scale the range of the data
                    x.domain(data.map(function(d) { return d.Letter; }));
                    y.domain([0, d3.max(data, function(d) { return d.Freq; })]);

                    // add axis
                    svg.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis)
                        .selectAll("text")
                        .style("text-anchor", "end")
                        .attr("dx", "-.8em")
                        .attr("dy", "-.55em")
                        .attr("transform", "rotate(-90)" );

                    svg.append("g")
                        .attr("class", "y axis")
                        .call(yAxis)
                        .append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 5)
                        .attr("dy", ".71em")
                        .style("text-anchor", "end")
                        .text("Frequency");


                    // Add bar chart
                    svg.selectAll("bar")
                        .data(data)
                        .enter().append("rect")
                        .attr("class", "bar")
                        .attr("x", function(d) { return x(d.Letter); })
                        .attr("width", x.rangeBand())
                        .attr("y", function(d) { return y(d.Freq); })
                        .attr("height", function(d) { return height - y(d.Freq); });

                });
                */
            </script>


    </body>
</html>